<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß† Memory Master - Ï§ëÎèÖÏÑ± Î©îÎ™®Î¶¨ Í≤åÏûÑ</title>
    
    <!-- PWA ÏÑ§Ï†ï -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#764ba2">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Memory Master">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: white;
            overflow-x: hidden;
        }

        .header {
            text-align: center;
            padding: 20px;
            background: rgba(0,0,0,0.2);
            width: 100%;
            backdrop-filter: blur(10px);
        }

        .title {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .stats {
            display: flex;
            justify-content: space-around;
            max-width: 600px;
            margin: 0 auto;
        }

        .stat {
            text-align: center;
            background: rgba(255,255,255,0.1);
            padding: 10px 20px;
            border-radius: 15px;
            backdrop-filter: blur(5px);
        }

        .stat-value {
            font-size: 1.8em;
            font-weight: bold;
            color: #ffeb3b;
        }

        .game-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            max-width: 800px;
            width: 100%;
        }

        .level-info {
            background: rgba(255,255,255,0.15);
            padding: 15px 30px;
            border-radius: 25px;
            margin-bottom: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255,255,255,0.2);
        }

        .level-title {
            font-size: 1.5em;
            margin-bottom: 5px;
        }

        .progress-bar {
            width: 200px;
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            overflow: hidden;
            margin: 0 auto;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            transition: width 0.3s ease;
        }

        .cards-grid {
            display: grid;
            gap: 8px;
            margin: 20px 0;
            perspective: 1000px;
            max-width: 100%;
            justify-content: center;
        }

        .card {
            width: 70px;
            height: 70px;
            position: relative;
            cursor: pointer;
            transform-style: preserve-3d;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @media (max-width: 480px) {
            .card {
                width: 60px;
                height: 60px;
            }
            .cards-grid {
                gap: 6px;
                padding: 0 10px;
            }
        }

        .card:hover {
            transform: scale(1.05);
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        .card.matched {
            transform: rotateY(180deg) scale(1.1);
            animation: matchPulse 0.4s ease;
        }

        .card.wrong {
            animation: shake 0.3s ease;
        }

        @keyframes matchPulse {
            0%, 100% { transform: rotateY(180deg) scale(1.1); }
            50% { transform: rotateY(180deg) scale(1.3); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            border: 3px solid rgba(255,255,255,0.3);
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
        }

        .card-back {
            background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
            color: white;
        }

        .card-front {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            transform: rotateY(180deg);
        }

        .controls {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #4caf50, #45a049);
            color: white;
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.6);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #ff9800, #f57c00);
            color: white;
            box-shadow: 0 6px 20px rgba(255, 152, 0, 0.4);
        }

        .combo-display {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4em;
            font-weight: bold;
            color: #ffeb3b;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.8);
            z-index: 1000;
            animation: comboAnimation 1.5s ease-out forwards;
            pointer-events: none;
            background: radial-gradient(circle, rgba(255,235,59,0.3) 0%, transparent 70%);
            padding: 30px;
            border-radius: 50%;
        }

        @keyframes comboAnimation {
            0% { 
                transform: translate(-50%, -50%) scale(0.3) rotate(-10deg);
                opacity: 0;
                filter: blur(5px);
            }
            30% { 
                transform: translate(-50%, -50%) scale(1.4) rotate(5deg);
                opacity: 1;
                filter: blur(0px);
            }
            70% { 
                transform: translate(-50%, -50%) scale(1.1) rotate(-2deg);
                opacity: 1;
            }
            100% { 
                transform: translate(-50%, -50%) scale(0.8) rotate(0deg);
                opacity: 0;
                filter: blur(2px);
            }
        }

        .combo-particles {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 999;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #ffeb3b;
            border-radius: 50%;
            animation: particleFloat 1s ease-out forwards;
        }

        @keyframes particleFloat {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(var(--random-x), var(--random-y)) scale(0);
                opacity: 0;
            }
        }

        .screen-flash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 235, 59, 0.3);
            z-index: 998;
            pointer-events: none;
            animation: flashEffect 0.3s ease-out;
        }

        @keyframes flashEffect {
            0% { opacity: 0; }
            50% { opacity: 1; }
            100% { opacity: 0; }
        }

        .penalty-display {
            position: fixed;
            top: 40%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2.5em;
            font-weight: bold;
            color: #f44336;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.8);
            z-index: 1000;
            animation: penaltyAnimation 1s ease-out forwards;
            pointer-events: none;
        }

        @keyframes penaltyAnimation {
            0% { 
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 0;
            }
            30% { 
                transform: translate(-50%, -50%) scale(1.2);
                opacity: 1;
            }
            100% { 
                transform: translate(-50%, -50%) scale(1) translateY(-30px);
                opacity: 0;
            }
        }

        .space-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #000011, #001122, #000033);
            z-index: 990;
            pointer-events: none;
            opacity: 0;
            animation: spaceTransition 3s ease-in-out forwards;
        }

        @keyframes spaceTransition {
            0% { opacity: 0; }
            20% { opacity: 1; }
            80% { opacity: 1; }
            100% { opacity: 0; }
        }

        .rocket {
            position: fixed;
            font-size: 3em;
            z-index: 995;
            pointer-events: none;
            animation: rocketFly 2s ease-out forwards;
        }

        @keyframes rocketFly {
            0% {
                transform: translate(-50px, 100vh) rotate(-45deg) scale(0.5);
                opacity: 1;
            }
            50% {
                transform: translate(50vw, 20vh) rotate(-30deg) scale(1.2);
                opacity: 1;
            }
            100% {
                transform: translate(120vw, -50px) rotate(-15deg) scale(0.8);
                opacity: 0;
            }
        }

        .bird {
            position: fixed;
            font-size: 2em;
            z-index: 995;
            pointer-events: none;
            animation: birdFly 1.5s ease-in-out forwards;
        }

        @keyframes birdFly {
            0% {
                transform: translateX(-50px) translateY(80vh) scale(0.8);
                opacity: 1;
            }
            25% {
                transform: translateX(25vw) translateY(60vh) scale(1) rotate(10deg);
            }
            75% {
                transform: translateX(75vw) translateY(40vh) scale(1.1) rotate(-10deg);
            }
            100% {
                transform: translateX(120vw) translateY(20vh) scale(0.9);
                opacity: 0;
            }
        }

        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 991;
            pointer-events: none;
        }

        .star {
            position: absolute;
            color: white;
            font-size: 1.5em;
            animation: twinkle 2s ease-in-out infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        .timer-container {
            width: 100px;
            height: 40px;
            position: relative;
            margin: 0 auto;
        }

        .timer-bar {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
            border: 2px solid rgba(255,255,255,0.3);
        }

        .timer-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
            transition: width 1s linear;
            border-radius: 2px;
        }

        .timer-fill.warning {
            background: linear-gradient(90deg, #ff9800, #ffb74d);
            animation: warningPulse 0.5s ease-in-out infinite;
        }

        .timer-fill.danger {
            background: linear-gradient(90deg, #f44336, #ff5722);
            animation: dangerPulse 0.3s ease-in-out infinite;
        }

        @keyframes warningPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes dangerPulse {
            0%, 100% { opacity: 1; transform: scaleY(1); }
            50% { opacity: 0.8; transform: scaleY(1.2); }
        }

        .timer-text {
            position: absolute;
            top: 12px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.2em;
            font-weight: bold;
            color: #ffeb3b;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }

        .timer-text.warning {
            color: #ff9800;
            animation: warningShake 0.5s ease-in-out infinite;
        }

        .timer-text.danger {
            color: #f44336;
            animation: dangerShake 0.2s ease-in-out infinite;
        }

        @keyframes warningShake {
            0%, 100% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.1); }
        }

        @keyframes dangerShake {
            0%, 100% { transform: translateX(-50%) translateY(0px); }
            25% { transform: translateX(-50%) translateY(-1px); }
            75% { transform: translateX(-50%) translateY(1px); }
        }

        .cards-grid.warning {
            animation: cardWarning 2s ease-in-out infinite;
        }

        .cards-grid.danger {
            animation: cardDanger 0.5s ease-in-out infinite;
        }

        @keyframes cardWarning {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        @keyframes cardDanger {
            0%, 100% { transform: translateX(0) scale(1); }
            25% { transform: translateX(-2px) scale(1.01); }
            75% { transform: translateX(2px) scale(1.01); }
        }

        .screen-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 500;
        }

        .screen-overlay.warning {
            background: radial-gradient(circle, transparent 60%, rgba(255, 152, 0, 0.1) 100%);
            animation: warningOverlay 2s ease-in-out infinite;
        }

        .screen-overlay.danger {
            background: radial-gradient(circle, transparent 50%, rgba(244, 67, 54, 0.2) 100%);
            animation: dangerOverlay 0.5s ease-in-out infinite;
        }

        @keyframes warningOverlay {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }

        @keyframes dangerOverlay {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .heartbeat {
            animation: heartbeat 0.8s ease-in-out infinite;
        }

        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .items-bar {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            justify-content: center;
            flex-wrap: wrap;
        }

        .item {
            background: linear-gradient(135deg, #4caf50, #45a049);
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 1.5em;
            color: white;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

        .item:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.5);
        }

        .item:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: scale(0.9);
        }

        .item-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #ff4444;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.8em;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .item-drop {
            position: fixed;
            font-size: 2em;
            z-index: 1000;
            pointer-events: none;
            animation: itemDrop 1.5s ease-out forwards;
        }

        @keyframes itemDrop {
            0% {
                transform: translateY(-50px) scale(0);
                opacity: 0;
            }
            50% {
                transform: translateY(0) scale(1.3);
                opacity: 1;
            }
            100% {
                transform: translateY(20px) scale(1);
                opacity: 0;
            }
        }

        .gun-target {
            cursor: crosshair !important;
            border: 3px solid #ff4444 !important;
            animation: targetPulse 0.5s ease-in-out infinite !important;
        }

        @keyframes targetPulse {
            0%, 100% { border-color: #ff4444; }
            50% { border-color: #ff8888; }
        }

        .card-destroyed {
            animation: cardDestroy 0.8s ease-out forwards;
        }

        @keyframes cardDestroy {
            0% { transform: scale(1) rotate(0deg); opacity: 1; }
            50% { transform: scale(1.2) rotate(180deg); opacity: 0.5; }
            100% { transform: scale(0) rotate(360deg); opacity: 0; }
        }

        .achievement {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #ffd700, #ffb347);
            color: #333;
            padding: 15px 25px;
            border-radius: 10px;
            font-weight: bold;
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.4);
            animation: slideInRight 0.5s ease-out;
            z-index: 1000;
        }

        @keyframes slideInRight {
            0% { transform: translateX(100%); }
            100% { transform: translateX(0); }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1 class="title">üß† Memory Master</h1>
        <div class="stats">
            <div class="stat">
                <div class="stat-value" id="score">0</div>
                <div>Ï†êÏàò</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="level">1</div>
                <div>Î†àÎ≤®</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="combo">0</div>
                <div>ÏΩ§Î≥¥</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="timer">60</div>
                <div>ÏãúÍ∞Ñ</div>
            </div>
        </div>
    </div>

    <div class="game-container">
        <div class="level-info">
            <div class="level-title">Î†àÎ≤® <span id="currentLevel">1</span> - <span id="levelName">Ï¥àÎ≥¥Ïûê</span></div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
        </div>

        <div class="items-bar">
            <button class="item" onclick="useGun()" :disabled="gameState.items.gun === 0">
                üî´
                <span class="item-count" id="gunCount">0</span>
            </button>
            <button class="item" onclick="useTimeAdd()" :disabled="gameState.items.timeAdd === 0">
                ‚è∞
                <span class="item-count" id="timeAddCount">0</span>
            </button>
            <button class="item" onclick="useHintItem()" :disabled="gameState.items.hint === 0">
                üí°
                <span class="item-count" id="hintItemCount">0</span>
            </button>
            <button class="item" onclick="useFreeze()" :disabled="gameState.items.freeze === 0">
                ‚ùÑÔ∏è
                <span class="item-count" id="freezeCount">0</span>
            </button>
        </div>

        <div class="cards-grid" id="cardsGrid"></div>

        <div class="controls">
            <button class="btn btn-primary" onclick="startNewGame()">ÏÉà Í≤åÏûÑ</button>
            <button class="btn btn-secondary" onclick="useHint()">ÌûåÌä∏ (3Í∞ú)</button>
            <button class="btn btn-secondary" onclick="toggleSound()" id="soundBtn">üîä ÏÇ¨Ïö¥Îìú</button>
        </div>
    </div>

    <script>
        // üîä ÏÇ¨Ïö¥Îìú ÏãúÏä§ÌÖú - Í∞úÏÑ†Îêú Î≤ÑÏ†Ñ
        let audioContext = null;
        let soundEnabled = false;

        // Ïò§ÎîîÏò§ Ïª®ÌÖçÏä§Ìä∏ Ï¥àÍ∏∞Ìôî
        function initAudio() {
            if (audioContext) return;
            
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                soundEnabled = true;
                console.log('üîä ÏÇ¨Ïö¥Îìú ÏãúÏä§ÌÖú ÌôúÏÑ±Ìôî');
            } catch (e) {
                console.log('ÏÇ¨Ïö¥ÎìúÎ•º ÏßÄÏõêÌïòÏßÄ ÏïäÎäî Î∏åÎùºÏö∞Ï†ÄÏûÖÎãàÎã§.');
                soundEnabled = false;
            }
        }

        // ÏÇ¨Ïö©Ïûê Ï≤´ ÌÅ¥Î¶≠ Ïãú Ïò§ÎîîÏò§ ÌôúÏÑ±Ìôî
        document.addEventListener('click', function initAudioOnFirstClick() {
            initAudio();
            if (audioContext && audioContext.state === 'suspended') {
                audioContext.resume();
            }
            document.removeEventListener('click', initAudioOnFirstClick);
        }, { once: true });

        const sounds = {
            flip: () => playBeep(800, 100),
            match: () => playBeep([523, 659, 784], 200),
            wrong: () => playBeep(200, 300),
            combo: () => playBeep([440, 554, 659, 880], 150),
            levelUp: () => playBeep([523, 659, 784, 1047], 300),
            item: () => playBeep([1047, 1319], 200),
            gunShoot: () => playBeep([100, 80, 60], 100),
            timeAdd: () => playBeep([659, 784, 880], 250)
        };

        function playBeep(frequency, duration) {
            if (!soundEnabled || !audioContext) return;
            
            try {
                if (audioContext.state === 'suspended') {
                    audioContext.resume();
                }
                
                if (Array.isArray(frequency)) {
                    // ÌôîÏùå ÎòêÎäî Ïó∞ÏÜçÏùå
                    frequency.forEach((freq, index) => {
                        setTimeout(() => {
                            createBeep(freq, duration / frequency.length);
                        }, index * (duration / frequency.length));
                    });
                } else {
                    createBeep(frequency, duration);
                }
            } catch (e) {
                console.log('ÏÇ¨Ïö¥Îìú Ïû¨ÏÉù Ïò§Î•ò:', e);
            }
        }

        function createBeep(frequency, duration) {
            if (!audioContext) return;
            
            try {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = frequency;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration / 1000);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration / 1000);
                
                // Î©îÎ™®Î¶¨ Ï†ïÎ¶¨
                oscillator.onended = () => {
                    oscillator.disconnect();
                    gainNode.disconnect();
                };
            } catch (e) {
                console.log('ÎπÑÌîÑÏùå ÏÉùÏÑ± Ïò§Î•ò:', e);
            }
        }

        let gameState = {
            level: 1,
            score: 0,
            combo: 0,
            timer: 45, // ÏãúÏûë ÏãúÍ∞ÑÏùÑ 60 ‚Üí 45Ï¥àÎ°ú Ï°∞Ï†ï
            cards: [],
            flippedCards: [],
            matchedPairs: 0,
            totalPairs: 0,
            hints: 3,
            gameActive: false,
            timerInterval: null,
            items: {
                gun: 0,
                timeAdd: 0,
                hint: 0,
                freeze: 0
            }
        };

        const emojis = ['üê∂', 'üê±', 'üê≠', 'üêπ', 'üê∞', 'ü¶ä', 'üêª', 'üêº', 'üê®', 'üêØ', 'ü¶Å', 'üêÆ', 'üê∑', 'üê∏', 'üêô', 'üêµ', 'üêî', 'üêß', 'ü¶Ü', 'ü¶ã', 'üêù', 'üêû', 'ü¶Ä', 'üê¢', 'üêç', 'ü¶é', 'üê≤', 'üê≥', 'üêã', 'üê†'];

        const levels = [
            { pairs: 3, name: 'Ï¥àÎ≥¥Ïûê', time: 45, gridCols: 3 },
            { pairs: 4, name: 'ÏûÖÎ¨∏Ïûê', time: 50, gridCols: 4 },
            { pairs: 6, name: 'ÏïÑÎßàÏ∂îÏñ¥', time: 55, gridCols: 4 },
            { pairs: 8, name: 'Ï§ëÍ∏âÏûê', time: 60, gridCols: 4 },
            { pairs: 10, name: 'Í≥†Í∏âÏûê', time: 65, gridCols: 5 },
            { pairs: 12, name: 'Ï†ÑÎ¨∏Í∞Ä', time: 70, gridCols: 4 }, // 6x4 = 24Í∞ú
            { pairs: 15, name: 'ÎßàÏä§ÌÑ∞', time: 75, gridCols: 5 }, // 6x5 = 30Í∞ú
            { pairs: 18, name: 'Í∑∏ÎûúÎìúÎßàÏä§ÌÑ∞', time: 80, gridCols: 6 } // 6x6 = 36Í∞ú
        ];

        function initGame() {
            const currentLevel = levels[gameState.level - 1] || levels[levels.length - 1];
            gameState.totalPairs = currentLevel.pairs;
            gameState.matchedPairs = 0;
            gameState.timer = currentLevel.time;
            gameState.flippedCards = [];
            gameState.gameActive = true;

            // Î™®Îì† Ìö®Í≥º Ï¥àÍ∏∞Ìôî
            document.body.classList.remove('heartbeat');
            const overlay = document.querySelector('.screen-overlay');
            if (overlay) document.body.removeChild(overlay);

            createCards(currentLevel.pairs, currentLevel.gridCols);
            updateDisplay();
            startTimer();
        }

        function createCards(pairs, gridCols) {
            const shuffledEmojis = emojis.sort(() => Math.random() - 0.5).slice(0, pairs);
            const cardEmojis = [...shuffledEmojis, ...shuffledEmojis].sort(() => Math.random() - 0.5);
            
            gameState.cards = cardEmojis.map((emoji, index) => ({
                id: index,
                emoji: emoji,
                flipped: false,
                matched: false
            }));

            const grid = document.getElementById('cardsGrid');
            const totalCards = pairs * 2;
            const rows = Math.ceil(totalCards / gridCols);
            
            // Î∞òÏùëÌòï Í∑∏Î¶¨Îìú ÏÑ§Ï†ï
            if (window.innerWidth <= 480) {
                grid.style.gridTemplateColumns = `repeat(${Math.min(gridCols, 4)}, 1fr)`;
            } else {
                grid.style.gridTemplateColumns = `repeat(${gridCols}, 1fr)`;
            }
            
            grid.innerHTML = '';

            gameState.cards.forEach(card => {
                const cardElement = document.createElement('div');
                cardElement.className = 'card';
                cardElement.onclick = () => flipCard(card.id);
                
                cardElement.innerHTML = `
                    <div class="card-face card-back">üé¥</div>
                    <div class="card-face card-front">${card.emoji}</div>
                `;
                
                grid.appendChild(cardElement);
            });
        }

        function flipCard(cardId) {
            if (!gameState.gameActive) return;
            
            const card = gameState.cards[cardId];
            if (card.flipped || card.matched) return;
            
            // Ïù¥ÎØ∏ 2Í∞úÍ∞Ä Îí§ÏßëÏñ¥Ï†∏ ÏûàÎã§Î©¥, Î®ºÏ†Ä Îí§ÏßëÏñ¥ÏßÑ Ïπ¥ÎìúÎì§ÏùÑ Ï≤òÎ¶¨ÌïòÍ≥† ÎåÄÍ∏∞
            if (gameState.flippedCards.length >= 2) {
                return; // ÏôÑÏ†ÑÌûà ÎßâÍ∏∞
            }

            card.flipped = true;
            gameState.flippedCards.push(cardId);
            
            const cardElement = document.querySelectorAll('.card')[cardId];
            cardElement.classList.add('flipped');
            
            // üîä Ïπ¥Îìú Îí§ÏßëÍ∏∞ ÏÇ¨Ïö¥Îìú
            sounds.flip();

            if (gameState.flippedCards.length === 2) {
                // Í≤åÏûÑÏùÑ Ïû†Ïãú ÎπÑÌôúÏÑ±ÌôîÌï¥ÏÑú Ïó∞ÏÜç ÌÅ¥Î¶≠ Î∞©ÏßÄ
                gameState.gameActive = false;
                setTimeout(() => {
                    checkMatch();
                    gameState.gameActive = true;
                }, 400); // 0.8Ï¥à ‚Üí 0.4Ï¥àÎ°ú Îã®Ï∂ï
            }
        }

        function checkMatch() {
            const [card1Id, card2Id] = gameState.flippedCards;
            const card1 = gameState.cards[card1Id];
            const card2 = gameState.cards[card2Id];

            if (card1.emoji === card2.emoji) {
                // Îß§Ïπò ÏÑ±Í≥µ
                card1.matched = true;
                card2.matched = true;
                gameState.matchedPairs++;
                gameState.combo++;
                
                const matchScore = 100 * gameState.combo;
                gameState.score += matchScore;

                document.querySelectorAll('.card')[card1Id].classList.add('matched');
                document.querySelectorAll('.card')[card2Id].classList.add('matched');

                // üîä Îß§Ïπò ÏÑ±Í≥µ ÏÇ¨Ïö¥Îìú
                sounds.match();
                
                // ÏΩ§Î≥¥ ÏÇ¨Ïö¥Îìú
                if (gameState.combo >= 3) {
                    setTimeout(() => sounds.combo(), 200);
                }

                showComboEffect();

                // ÎûúÎç§ ÏïÑÏù¥ÌÖú ÎìúÎ°≠ (30% ÌôïÎ•†, 3ÏΩ§Î≥¥ Ïù¥ÏÉÅÏãú 50% ÌôïÎ•†)
                const dropChance = gameState.combo >= 3 ? 0.5 : 0.3;
                if (Math.random() < dropChance) {
                    dropRandomItem();
                }

                if (gameState.combo >= 5) {
                    showAchievement(`üöÄ ${gameState.combo} Ïó∞ÏÜç ÏÑ±Í≥µ! ÎåÄÎ∞ï!`);
                } else if (gameState.combo >= 3) {
                    showAchievement(`üî• ${gameState.combo} ÏΩ§Î≥¥ Îã¨ÏÑ±!`);
                }

                if (gameState.matchedPairs === gameState.totalPairs) {
                    levelComplete();
                }
            } else {
                // Îß§Ïπò Ïã§Ìå® - ÏãúÍ∞Ñ Í∞êÏÜå!
                const timePenalty = Math.max(3, Math.floor(gameState.level / 2) + 2);
                gameState.timer = Math.max(0, gameState.timer - timePenalty);
                gameState.combo = 0;
                
                // ÏãúÍ∞Ñ Í∞êÏÜå ÌëúÏãú
                showTimePenalty(timePenalty);
                
                // üîä ÌãÄÎ†∏ÏùÑ Îïå ÏÇ¨Ïö¥Îìú
                sounds.wrong();
                
                setTimeout(() => {
                    card1.flipped = false;
                    card2.flipped = false;
                    
                    const cardElements = document.querySelectorAll('.card');
                    cardElements[card1Id].classList.remove('flipped');
                    cardElements[card2Id].classList.remove('flipped');
                    cardElements[card1Id].classList.add('wrong');
                    cardElements[card2Id].classList.add('wrong');
                    
                    setTimeout(() => {
                        cardElements[card1Id].classList.remove('wrong');
                        cardElements[card2Id].classList.remove('wrong');
                    }, 300); // 0.5Ï¥à ‚Üí 0.3Ï¥àÎ°ú Îã®Ï∂ï
                }, 600); // 1Ï¥à ‚Üí 0.6Ï¥àÎ°ú Îã®Ï∂ï
            }

            gameState.flippedCards = [];
            updateDisplay();
        }

        function showComboEffect() {
            if (gameState.combo <= 1) return;
            
            // ÌôîÎ©¥ ÌîåÎûòÏãú Ìö®Í≥º
            if (gameState.combo >= 3) {
                const flash = document.createElement('div');
                flash.className = 'screen-flash';
                document.body.appendChild(flash);
                setTimeout(() => document.body.removeChild(flash), 300);
            }

            // Ïö∞Ï£º Î∞∞Í≤Ω Ìö®Í≥º (7ÏΩ§Î≥¥ Ïù¥ÏÉÅ)
            if (gameState.combo >= 7) {
                createSpaceEffect();
            }

            // Î°úÏºì Ìö®Í≥º (5ÏΩ§Î≥¥ Ïù¥ÏÉÅ)
            if (gameState.combo >= 5) {
                createRocket();
            }

            // ÏÉà Ìö®Í≥º (3ÏΩ§Î≥¥ Ïù¥ÏÉÅ)
            if (gameState.combo >= 3) {
                createBirds();
            }
            
            // ÏΩ§Î≥¥ ÌÖçÏä§Ìä∏ ÌëúÏãú
            const comboDiv = document.createElement('div');
            comboDiv.className = 'combo-display';
            
            // ÏΩ§Î≥¥ Îã®Í≥ÑÎ≥Ñ Îã§Î•∏ ÌÖçÏä§Ìä∏ÏôÄ ÏÉâÏÉÅ
            if (gameState.combo >= 10) {
                comboDiv.innerHTML = `üåå UNIVERSE ${gameState.combo} COMBO! üåå<br><small>ÏãúÍ≥µÍ∞Ñ Ïù¥Îèô!</small>`;
                comboDiv.style.color = '#ff1744';
                comboDiv.style.fontSize = '5em';
            } else if (gameState.combo >= 7) {
                comboDiv.innerHTML = `üöÄ SPACE ${gameState.combo} COMBO! üöÄ<br><small>Ïö∞Ï£ºÎ°ú!</small>`;
                comboDiv.style.color = '#e91e63';
                comboDiv.style.fontSize = '4.5em';
            } else if (gameState.combo >= 5) {
                comboDiv.innerHTML = `üöÄ ROCKET ${gameState.combo} COMBO! üöÄ<br><small>ÌïòÎäòÎ°ú!</small>`;
                comboDiv.style.color = '#9c27b0';
            } else if (gameState.combo >= 3) {
                comboDiv.innerHTML = `üê¶ FLYING ${gameState.combo} COMBO! üê¶<br><small>ÎÇ†ÏïÑÏò¨Îùº!</small>`;
                comboDiv.style.color = '#ff5722';
            } else {
                comboDiv.textContent = `${gameState.combo} COMBO!`;
            }
            
            document.body.appendChild(comboDiv);
            
            // ÌååÌã∞ÌÅ¥ Ìö®Í≥º ÏÉùÏÑ±
            createParticles(gameState.combo);
            
            setTimeout(() => {
                if (document.body.contains(comboDiv)) {
                    document.body.removeChild(comboDiv);
                }
            }, 2000);
        }

        function createSpaceEffect() {
            // Ïö∞Ï£º Î∞∞Í≤Ω
            const space = document.createElement('div');
            space.className = 'space-background';
            document.body.appendChild(space);

            // Î≥ÑÎì§ ÏÉùÏÑ±
            const stars = document.createElement('div');
            stars.className = 'stars';
            
            for (let i = 0; i < 20; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.textContent = '‚ú¶';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 2 + 's';
                stars.appendChild(star);
            }
            
            document.body.appendChild(stars);

            setTimeout(() => {
                if (document.body.contains(space)) document.body.removeChild(space);
                if (document.body.contains(stars)) document.body.removeChild(stars);
            }, 3000);
        }

        function createRocket() {
            const rockets = ['üöÄ', 'üõ∏', 'üåü'];
            const rocketCount = Math.min(3, Math.floor(gameState.combo / 2));
            
            for (let i = 0; i < rocketCount; i++) {
                const rocket = document.createElement('div');
                rocket.className = 'rocket';
                rocket.textContent = rockets[i % rockets.length];
                rocket.style.left = Math.random() * 100 + 'px';
                rocket.style.animationDelay = i * 0.3 + 's';
                document.body.appendChild(rocket);
                
                setTimeout(() => {
                    if (document.body.contains(rocket)) {
                        document.body.removeChild(rocket);
                    }
                }, 2500);
            }
        }

        function createBirds() {
            const birds = ['üê¶', 'üïäÔ∏è', 'ü¶Ö', 'ü¶ã'];
            const birdCount = Math.min(4, gameState.combo);
            
            for (let i = 0; i < birdCount; i++) {
                const bird = document.createElement('div');
                bird.className = 'bird';
                bird.textContent = birds[i % birds.length];
                bird.style.top = (20 + Math.random() * 40) + '%';
                bird.style.animationDelay = i * 0.2 + 's';
                document.body.appendChild(bird);
                
                setTimeout(() => {
                    if (document.body.contains(bird)) {
                        document.body.removeChild(bird);
                    }
                }, 2000);
            }
        }

        function showTimePenalty(penalty) {
            const penaltyDiv = document.createElement('div');
            penaltyDiv.className = 'penalty-display';
            penaltyDiv.innerHTML = `‚è∞ -${penalty}Ï¥à ‚è∞<br><small>ÏãúÍ∞Ñ Í∞êÏÜå!</small>`;
            penaltyDiv.style.color = '#ff9800';
            document.body.appendChild(penaltyDiv);
            
            setTimeout(() => {
                if (document.body.contains(penaltyDiv)) {
                    document.body.removeChild(penaltyDiv);
                }
            }, 1000);
        }

        function dropRandomItem() {
            const items = ['gun', 'timeAdd', 'hint', 'freeze'];
            const itemEmojis = {'gun': 'üî´', 'timeAdd': '‚è∞', 'hint': 'üí°', 'freeze': '‚ùÑÔ∏è'};
            const randomItem = items[Math.floor(Math.random() * items.length)];
            
            gameState.items[randomItem]++;
            
            // ÏïÑÏù¥ÌÖú ÎìúÎ°≠ Ïï†ÎãàÎ©îÏù¥ÏÖò
            const itemDiv = document.createElement('div');
            itemDiv.className = 'item-drop';
            itemDiv.textContent = itemEmojis[randomItem];
            itemDiv.style.left = Math.random() * 80 + 10 + '%';
            itemDiv.style.top = '20%';
            document.body.appendChild(itemDiv);
            
            setTimeout(() => {
                if (document.body.contains(itemDiv)) {
                    document.body.removeChild(itemDiv);
                }
            }, 1500);
            
            updateItemDisplay();
            showAchievement(`üéÅ ${itemEmojis[randomItem]} ÏïÑÏù¥ÌÖú ÌöçÎìù!`);
            
            // üîä ÏïÑÏù¥ÌÖú ÌöçÎìù ÏÇ¨Ïö¥Îìú
            sounds.item();
        }

        function updateItemDisplay() {
            document.getElementById('gunCount').textContent = gameState.items.gun;
            document.getElementById('timeAddCount').textContent = gameState.items.timeAdd;
            document.getElementById('hintItemCount').textContent = gameState.items.hint;
            document.getElementById('freezeCount').textContent = gameState.items.freeze;
            
            // Î≤ÑÌäº ÌôúÏÑ±Ìôî/ÎπÑÌôúÏÑ±Ìôî
            document.querySelector('.item:nth-child(1)').disabled = gameState.items.gun === 0;
            document.querySelector('.item:nth-child(2)').disabled = gameState.items.timeAdd === 0;
            document.querySelector('.item:nth-child(3)').disabled = gameState.items.hint === 0;
            document.querySelector('.item:nth-child(4)').disabled = gameState.items.freeze === 0;
        }

        function useGun() {
            if (gameState.items.gun <= 0 || !gameState.gameActive) return;
            
            gameState.items.gun--;
            updateItemDisplay();
            
            // ÌÉÄÍ≤üÌåÖ Î™®Îìú ÌôúÏÑ±Ìôî
            const unmatched = gameState.cards.filter(card => !card.matched);
            if (unmatched.length === 0) return;
            
            const cardElements = document.querySelectorAll('.card');
            unmatched.forEach(card => {
                cardElements[card.id].classList.add('gun-target');
                cardElements[card.id].onclick = () => destroyCard(card.id);
            });
            
            showAchievement('üéØ Ïπ¥ÎìúÎ•º ÌÅ¥Î¶≠Ìï¥ÏÑú Ï†úÍ±∞ÌïòÏÑ∏Ïöî!');
            
            // üîä Ï¥ù ÏÇ¨Ïö¥Îìú
            sounds.gunShoot();
            
            // 5Ï¥à ÌõÑ ÌÉÄÍ≤üÌåÖ Î™®Îìú Ìï¥Ï†ú
            setTimeout(() => {
                unmatched.forEach(card => {
                    if (cardElements[card.id]) {
                        cardElements[card.id].classList.remove('gun-target');
                        cardElements[card.id].onclick = () => flipCard(card.id);
                    }
                });
            }, 5000);
        }

        function destroyCard(cardId) {
            const card = gameState.cards[cardId];
            if (card.matched) return;
            
            card.matched = true;
            const cardElement = document.querySelectorAll('.card')[cardId];
            cardElement.classList.add('card-destroyed');
            cardElement.classList.remove('gun-target');
            cardElement.onclick = null;
            
            // Îß§ÏπòÎêú ÏåçÎèÑ Ï∞æÏïÑÏÑú Ï†úÍ±∞
            const pairCard = gameState.cards.find(c => c.emoji === card.emoji && c.id !== cardId && !c.matched);
            if (pairCard) {
                pairCard.matched = true;
                const pairElement = document.querySelectorAll('.card')[pairCard.id];
                pairElement.classList.add('card-destroyed');
                pairElement.classList.remove('gun-target');
                pairElement.onclick = null;
            }
            
            gameState.matchedPairs++;
            gameState.score += 200; // Î≥¥ÎÑàÏä§ Ï†êÏàò
            
            // Î™®Îì† ÌÉÄÍ≤üÌåÖ Î™®Îìú Ìï¥Ï†ú
            document.querySelectorAll('.gun-target').forEach(el => {
                el.classList.remove('gun-target');
                const cardId = Array.from(document.querySelectorAll('.card')).indexOf(el);
                el.onclick = () => flipCard(cardId);
            });
            
            showAchievement('üí• Ïπ¥Îìú ÌååÍ¥¥! +200Ï†ê!');
            updateDisplay();
            
            if (gameState.matchedPairs >= gameState.totalPairs) {
                levelComplete();
            }
        }

        function useTimeAdd() {
            if (gameState.items.timeAdd <= 0) return;
            
            gameState.items.timeAdd--;
            gameState.timer += 15;
            updateItemDisplay();
            updateDisplay();
            showAchievement('‚è∞ +15Ï¥à Ï∂îÍ∞Ä!');
            
            // üîä ÏãúÍ∞Ñ Ï∂îÍ∞Ä ÏÇ¨Ïö¥Îìú
            sounds.timeAdd();
        }

        function useHintItem() {
            if (gameState.items.hint <= 0 || !gameState.gameActive) return;
            
            gameState.items.hint--;
            updateItemDisplay();
            
            const unmatched = gameState.cards.filter(card => !card.matched && !card.flipped);
            if (unmatched.length >= 2) {
                const randomCard = unmatched[Math.floor(Math.random() * unmatched.length)];
                const matchingCard = unmatched.find(card => card.emoji === randomCard.emoji && card.id !== randomCard.id);
                
                if (matchingCard) {
                    const cardElement1 = document.querySelectorAll('.card')[randomCard.id];
                    const cardElement2 = document.querySelectorAll('.card')[matchingCard.id];
                    
                    cardElement1.style.border = '3px solid #ffeb3b';
                    cardElement2.style.border = '3px solid #ffeb3b';
                    
                    setTimeout(() => {
                        cardElement1.style.border = '3px solid rgba(255,255,255,0.3)';
                        cardElement2.style.border = '3px solid rgba(255,255,255,0.3)';
                    }, 3000);
                    
                    showAchievement('üí° ÌûåÌä∏ ÏÇ¨Ïö©!');
                }
            }
        }

        function useFreeze() {
            if (gameState.items.freeze <= 0) return;
            
            gameState.items.freeze--;
            updateItemDisplay();
            
            // ÌÉÄÏù¥Î®∏ ÏùºÏãúÏ†ïÏßÄ
            clearInterval(gameState.timerInterval);
            showAchievement('‚ùÑÔ∏è ÏãúÍ∞Ñ Ï†ïÏßÄ! (10Ï¥àÍ∞Ñ)');
            
            setTimeout(() => {
                if (gameState.gameActive) {
                    startTimer();
                }
            }, 10000);
        }

        function createParticles(comboCount) {
            const particleContainer = document.createElement('div');
            particleContainer.className = 'combo-particles';
            document.body.appendChild(particleContainer);
            
            const particleCount = Math.min(comboCount * 3, 20);
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                // ÎûúÎç§Ìïú Î∞©Ìñ•Í≥º Í±∞Î¶¨
                const angle = (Math.PI * 2 * i) / particleCount;
                const distance = 100 + Math.random() * 100;
                const randomX = Math.cos(angle) * distance + (Math.random() - 0.5) * 50;
                const randomY = Math.sin(angle) * distance + (Math.random() - 0.5) * 50;
                
                particle.style.setProperty('--random-x', `${randomX}px`);
                particle.style.setProperty('--random-y', `${randomY}px`);
                
                // Îã§ÏñëÌïú ÏÉâÏÉÅ
                const colors = ['#ffeb3b', '#ff5722', '#e91e63', '#9c27b0', '#3f51b5', '#00bcd4'];
                particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                
                // Îã§ÏñëÌïú ÌÅ¨Í∏∞
                const size = 4 + Math.random() * 8;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                
                // ÏßÄÏó∞ ÏãúÍ∞ÑÏúºÎ°ú ÏàúÏ∞®Ï†Å Ïï†ÎãàÎ©îÏù¥ÏÖò
                particle.style.animationDelay = `${i * 50}ms`;
                
                particleContainer.appendChild(particle);
            }
            
            // ÌååÌã∞ÌÅ¥ Ïª®ÌÖåÏù¥ÎÑà Ï†úÍ±∞
            setTimeout(() => {
                if (document.body.contains(particleContainer)) {
                    document.body.removeChild(particleContainer);
                }
            }, 1500);
        }

        function showAchievement(text) {
            const achievementDiv = document.createElement('div');
            achievementDiv.className = 'achievement';
            achievementDiv.textContent = text;
            document.body.appendChild(achievementDiv);
            
            setTimeout(() => {
                document.body.removeChild(achievementDiv);
            }, 3000);
        }

        function levelComplete() {
            gameState.gameActive = false;
            clearInterval(gameState.timerInterval);
            
            const timeBonus = gameState.timer * 10;
            const levelBonus = gameState.level * 500;
            gameState.score += timeBonus + levelBonus;
            
            showAchievement(`üéâ Î†àÎ≤® ${gameState.level} ÌÅ¥Î¶¨Ïñ¥! Î≥¥ÎÑàÏä§: ${timeBonus + levelBonus}Ï†ê`);
            
            setTimeout(() => {
                gameState.level++;
                initGame();
            }, 1500); // 2Ï¥à ‚Üí 1.5Ï¥àÎ°ú Îã®Ï∂ï
        }

        function startTimer() {
            const maxTime = levels[gameState.level - 1]?.time || 45;
            
            gameState.timerInterval = setInterval(() => {
                gameState.timer--;
                updateDisplay();
                updateTimerEffects(maxTime);
                
                if (gameState.timer <= 0) {
                    gameOver();
                }
            }, 1000);
        }

        function updateTimerEffects(maxTime) {
            const timerFill = document.getElementById('timerFill');
            const timerText = document.getElementById('timerText');
            const cardsGrid = document.getElementById('cardsGrid');
            
            // ÏãúÍ∞Ñ ÎπÑÏú® Í≥ÑÏÇ∞
            const timePercent = (gameState.timer / maxTime) * 100;
            timerFill.style.width = timePercent + '%';
            
            // ÌôîÎ©¥ Ïò§Î≤ÑÎ†àÏù¥ Ï†úÍ±∞
            const existingOverlay = document.querySelector('.screen-overlay');
            if (existingOverlay) {
                document.body.removeChild(existingOverlay);
            }
            
            // Í∏∞Ï°¥ ÌÅ¥ÎûòÏä§ Ï†úÍ±∞
            timerFill.className = 'timer-fill';
            timerText.className = 'timer-text';
            cardsGrid.className = 'cards-grid';
            
            if (gameState.timer <= 5) {
                // üö® Í∑πÎèÑÎ°ú ÏúÑÌóò (5Ï¥à Ïù¥Ìïò)
                timerFill.classList.add('danger');
                timerText.classList.add('danger');
                cardsGrid.classList.add('danger');
                document.body.classList.add('heartbeat');
                
                // Îπ®Í∞Ñ ÌôîÎ©¥ Ïò§Î≤ÑÎ†àÏù¥
                const overlay = document.createElement('div');
                overlay.className = 'screen-overlay danger';
                document.body.appendChild(overlay);
                
                // ÏúÑÌóò ÏÇ¨Ïö¥Îìú (Îß§Ï¥à)
                if (soundEnabled) {
                    sounds.wrong();
                }
                
            } else if (gameState.timer <= 10) {
                // ‚ö†Ô∏è ÏúÑÌóò (10Ï¥à Ïù¥Ìïò)
                timerFill.classList.add('warning');
                timerText.classList.add('warning');
                cardsGrid.classList.add('warning');
                
                // Ï£ºÌô© ÌôîÎ©¥ Ïò§Î≤ÑÎ†àÏù¥
                const overlay = document.createElement('div');
                overlay.className = 'screen-overlay warning';
                document.body.appendChild(overlay);
                
                // Í≤ΩÍ≥† ÏÇ¨Ïö¥Îìú (5Ï¥àÎßàÎã§)
                if (soundEnabled && gameState.timer % 5 === 0) {
                    sounds.flip();
                }
                
            } else {
                // Ï†ïÏÉÅ ÏÉÅÌÉú
                document.body.classList.remove('heartbeat');
            }
        }

        function gameOver() {
            gameState.gameActive = false;
            clearInterval(gameState.timerInterval);
            
            // Î™®Îì† Ìö®Í≥º Ï†úÍ±∞
            document.body.classList.remove('heartbeat');
            const overlay = document.querySelector('.screen-overlay');
            if (overlay) document.body.removeChild(overlay);
            
            showAchievement(`üòµ Í≤åÏûÑ Ïò§Î≤Ñ! ÏµúÏ¢Ö Ï†êÏàò: ${gameState.score}Ï†ê`);
        }

        function updateDisplay() {
            document.getElementById('score').textContent = gameState.score.toLocaleString();
            document.getElementById('level').textContent = gameState.level;
            document.getElementById('combo').textContent = gameState.combo;
            document.getElementById('timerText').textContent = gameState.timer;
            document.getElementById('currentLevel').textContent = gameState.level;
            
            const currentLevelData = levels[gameState.level - 1] || levels[levels.length - 1];
            document.getElementById('levelName').textContent = currentLevelData.name;
            
            const progress = (gameState.matchedPairs / gameState.totalPairs) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
            
            updateItemDisplay();
        }

        function startNewGame() {
            clearInterval(gameState.timerInterval);
            gameState = {
                level: 1,
                score: 0,
                combo: 0,
                timer: 45, // ÏãúÏûë ÏãúÍ∞Ñ 45Ï¥àÎ°ú Ï°∞Ï†ï
                cards: [],
                flippedCards: [],
                matchedPairs: 0,
                totalPairs: 0,
                hints: 3,
                gameActive: false,
                timerInterval: null,
                items: {
                    gun: 0,
                    timeAdd: 0,
                    hint: 0,
                    freeze: 0
                }
            };
            initGame();
        }

        function useHint() {
            if (gameState.hints <= 0 || !gameState.gameActive) return;
            
            const unmatched = gameState.cards.filter(card => !card.matched && !card.flipped);
            if (unmatched.length >= 2) {
                const randomCard = unmatched[Math.floor(Math.random() * unmatched.length)];
                const matchingCard = unmatched.find(card => card.emoji === randomCard.emoji && card.id !== randomCard.id);
                
                if (matchingCard) {
                    const cardElement1 = document.querySelectorAll('.card')[randomCard.id];
                    const cardElement2 = document.querySelectorAll('.card')[matchingCard.id];
                    
                    cardElement1.style.border = '3px solid #ffeb3b';
                    cardElement2.style.border = '3px solid #ffeb3b';
                    
                    setTimeout(() => {
                        cardElement1.style.border = '3px solid rgba(255,255,255,0.3)';
                        cardElement2.style.border = '3px solid rgba(255,255,255,0.3)';
                    }, 2000);
                    
                    gameState.hints--;
                }
            }
        }

        function pauseGame() {
            if (gameState.gameActive) {
                gameState.gameActive = false;
                clearInterval(gameState.timerInterval);
                showAchievement('‚è∏Ô∏è Í≤åÏûÑ ÏùºÏãúÏ†ïÏßÄ');
            } else {
                gameState.gameActive = true;
                startTimer();
                showAchievement('‚ñ∂Ô∏è Í≤åÏûÑ Ïû¨Í∞ú');
            }
        }

        function toggleSound() {
            const btn = document.getElementById('soundBtn');
            if (soundEnabled) {
                soundEnabled = false;
                btn.textContent = 'üîá ÏÇ¨Ïö¥Îìú';
                btn.style.opacity = '0.6';
            } else {
                initAudio();
                if (audioContext) {
                    soundEnabled = true;
                    btn.textContent = 'üîä ÏÇ¨Ïö¥Îìú';
                    btn.style.opacity = '1';
                    // ÌÖåÏä§Ìä∏ ÏÇ¨Ïö¥Îìú Ïû¨ÏÉù
                    sounds.item();
                }
            }
        }

        // Í≤åÏûÑ ÏãúÏûë Ïãú ÏÇ¨Ïö¥Îìú Ï¥àÍ∏∞Ìôî ÏïàÎÇ¥
        function showSoundPrompt() {
            if (!soundEnabled) {
                setTimeout(() => {
                    showAchievement('üîä ÏÇ¨Ïö¥ÎìúÎ•º ÏºúÎ†§Î©¥ ÏÇ¨Ïö¥Îìú Î≤ÑÌäºÏùÑ ÌÅ¥Î¶≠ÌïòÏÑ∏Ïöî!');
                }, 1000);
            }
        }

        // Í≤åÏûÑ ÏãúÏûë
        initGame();
        showSoundPrompt();
    </script>
     <!-- ÏÑúÎπÑÏä§ ÏõåÏª§ Îì±Î°ù (body ÎÅùÎ∂ÄÎ∂ÑÏóê) -->
     <script>
        if ('serviceWorker' in navigator) {
          window.addEventListener('load', () => {
            navigator.serviceWorker.register('/sw.js')
              .then(registration => console.log('SW Îì±Î°ù ÏÑ±Í≥µ'))
              .catch(error => console.log('SW Îì±Î°ù Ïã§Ìå®'));
          });
        }
        </script>
</body>
</html>